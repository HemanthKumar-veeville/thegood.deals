import{a0 as R,a1 as D,r as a,d as N,a as I,u as L,c as P,l as A,j as e,a2 as B,a3 as H,C,L as S,K as M,a4 as q,S as W,a5 as z,e as K,a6 as V}from"./index-CLm6co3g.js";import{I as $}from"./InfoCircle8-CSRTFrzy.js";function G({heading:x,btnText:p,stripeCustomerId:f}){var E;const i=R(),s=D(),[o,r]=a.useState(null),[m,h]=a.useState(!1),t=N(w=>w.account.profile),[v,l]=a.useState((E=t==null?void 0:t.data)==null?void 0:E.email),{t:c}=I(),u=L(),k=P(),j=A(),[y,g]=a.useState(!1),n=new URLSearchParams(j.search).get("orderId"),T=async w=>{if(w.preventDefault(),!i||!s){r(c("checkout.stripe_not_loaded"));return}h(!0),r("");try{const{setupIntent:_,error:b}=await i.confirmSetup({elements:s,confirmParams:{},redirect:"if_required"});if(b)b.type==="card_error"||b.type==="validation_error"?r(b.message):r(c("checkout.unexpected_error")),console.error("Error during setup confirmation:",b);else{console.log("SetupIntent confirmed:",_),g(!0);try{await k(q({orderId:n,setupIntent:_,stripeCustomerId:f})),r(c("checkout.setup_confirmed")),u(`/thanks-payment-setup?orderId=${n}`)}catch(O){console.error("Error during dispatch:",O),r(c("checkout.processing_error"))}finally{g(!1)}}}catch(_){console.error("Unexpected error in setup confirmation:",_),r(c("checkout.unexpected_error_setup"))}finally{h(!1)}},F={layout:{type:"accordion",defaultCollapsed:!1,radios:!1,spacedAccordionItems:!0},appearance:{theme:"flat",variables:{colorPrimaryText:"#262626",colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Ideal Sans, system-ui, sans-serif",spacingUnit:"2px",borderRadius:"4px"},rules:{".Label":{display:"none"},".Input":{minHeight:"48px"}}}},U={defaultValues:{email:v},appearance:{theme:"flat",variables:{colorPrimaryText:"#262626",colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Ideal Sans, system-ui, sans-serif"},rules:{".Label":{display:"none"},".Input":{height:"76px"},".p-LinkInputWrapper":{height:"96px !important",display:"flex","align-items":"center"},".p-LinkInputWrapper input":{height:"78px !important",padding:"12px !important",border:"1px solid #ccc !important","border-radius":"4px !important","font-size":"36px !important",width:"100% !important"}}}};return e.jsxs("form",{id:"payment-form",onSubmit:T,className:"mx-auto w-full max-w-lg space-y-4",children:[!y&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{id:"link-authentication-element",onChange:w=>{l(w.value.email)},options:U}),e.jsx(H,{id:"payment-element",options:F,className:"pt-3"})]}),y&&e.jsx(C,{}),o&&e.jsx("div",{id:"payment-message",className:"mt-3 p-3 text-red-600 bg-red-100 border border-red-400 rounded",children:o}),e.jsx(S,{}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2.5 px-6 py-3 relative self-stretch w-full flex-[0_0_auto] bg-primary-color rounded-md",children:[e.jsxs("button",{type:"submit",disabled:m||!i||!s,className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-white text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:[c("checkout.submit_button")," "]}),e.jsx(M,{className:"!relative !w-5 !h-5",color:"white"})]})]})}function J({orderId:x,heading:p,btnText:f,...i}){const{stripePromise:s}=i,[o,r]=a.useState(""),[m,h]=a.useState(""),[t,v]=a.useState(!1),[l,c]=a.useState(""),{t:u}=I();return a.useEffect(()=>{(async()=>{var j,y,g;try{const d=new FormData;d.append("amount",10),d.append("currency","eur");const n=await K.post("/create_payment_intent",d);console.log((j=n==null?void 0:n.data)==null?void 0:j.payment_intent[0]),r((y=n==null?void 0:n.data)==null?void 0:y.payment_intent[0]),h((g=n==null?void 0:n.data)==null?void 0:g.payment_intent[1])}catch(d){console.error("Error creating PaymentIntent:",d),v(!0),c((d==null?void 0:d.detail)||u("Payment.fetch_error_message"))}})()},[u]),e.jsxs(e.Fragment,{children:[t&&e.jsx(W,{message:l,buttonText:u("waiting_deal.got_it"),onClose:()=>v(!1)}),o&&s&&e.jsx(z,{stripe:s,options:{clientSecret:o},children:e.jsx(G,{heading:u("Payment.heading"),btnText:u("Payment.button_text"),stripeCustomerId:m})})]})}const Q=({orderId:x})=>{const[p,f]=a.useState(!1),i=a.useRef(null),{t:s}=I(),o=P(),r=N(l=>l.orders.order),m=N(l=>l.orders.orderStatus),h=N(l=>l.orders.orderError),t=r==null?void 0:r.Orders;a.useEffect(()=>{o(V({orderId:x}))},[o,x]),console.log({orderState:t});const v=()=>{f(l=>!l)};return a.useEffect(()=>{const l=c=>{i.current&&!i.current.contains(c.target)&&f(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[i]),m==="loading"?e.jsx(C,{}):m==="failed"?e.jsx("div",{children:s("order.error",{error:h})}):e.jsx("div",{className:"flex flex-col items-start gap-[15px] p-[15px] relative bg-white rounded-[5px] mx-auto w-full",children:e.jsxs("div",{className:"flex flex-col items-start relative self-stretch w-full flex-[0_0_auto]",children:[e.jsxs("div",{className:"flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]",children:[e.jsx("div",{className:"flex w-[162.5px] items-center gap-[5px] relative",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-body-extra-small-text-regular text-primary-text-color",children:[s("order.orderLabel")," "]})}),e.jsx("div",{className:"inline-flex items-start justify-end gap-2.5 relative flex-[0_0_auto]",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-semibold text-primary-color text-sm text-right",children:[t==null?void 0:t.order_total," €"]})})]}),e.jsx("div",{className:"flex flex-col items-end gap-[5px] relative self-stretch w-full flex-[0_0_auto]",children:e.jsxs("div",{className:"flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]",children:[e.jsxs("div",{className:"flex w-full items-center gap-[5px] relative",children:[e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-body-extra-small-text-regular text-primary-text-color",children:[s("order.serviceFeesLabel")," "]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{onClick:v,children:e.jsx($,{className:"!relative !w-3.5 !h-3.5 cursor-pointer",color:"#2a4e4a"})}),p&&e.jsxs("div",{ref:i,className:"absolute z-10 w-[265px] p-2 bg-white text-gray-800 border border-gray-300 rounded-md shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-2",children:[s("order.serviceFeesTooltip")," ",e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-3 h-3 bg-white border border-gray-300 -bottom-1 rotate-45"})]})]})]}),e.jsx("div",{className:"inline-flex items-start justify-end gap-2.5 relative flex-[0_0_auto]",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-semibold text-primary-color text-sm text-right",children:[t==null?void 0:t.service_fees," €"]})})]})}),e.jsxs("div",{className:"flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]",children:[e.jsx("div",{className:"flex w-[162.5px] items-center gap-[5px] relative",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-body-extra-small-text-regular text-primary-text-color",children:[s("order.paymentFeesLabel")," "]})}),e.jsx("div",{className:"inline-flex items-start justify-end gap-2.5 relative flex-[0_0_auto]",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-semibold text-primary-color text-sm text-right",children:[t==null?void 0:t.payment_fees," €"]})})]}),e.jsxs("div",{className:"flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]",children:[e.jsx("div",{className:"flex w-[162.5px] items-center gap-[5px] relative",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-body-extra-small-text-regular text-primary-text-color",children:[s("order.deliveryFeesLabel")," "]})}),e.jsx("div",{className:"inline-flex items-start justify-end gap-2.5 relative flex-[0_0_auto]",children:e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-semibold text-primary-color text-sm text-right",children:[t==null?void 0:t.delivery_fees," €"]})})]}),e.jsx("div",{className:"flex flex-col items-end gap-[5px] relative self-stretch w-full flex-[0_0_auto]",children:e.jsxs("div",{className:"flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]",children:[e.jsxs("div",{className:"relative w-fit font-body-extra-small-text-regular text-primary-text-color",children:[s("order.totalTTC")," "]}),e.jsxs("div",{className:"inline-flex items-start justify-end gap-2.5 relative flex-[0_0_auto]",children:[e.jsxs("div",{className:"font-normal text-primary-text-color leading-6 line-through relative w-fit mt-[-1.00px] text-sm text-right",children:[(t==null?void 0:t.mrp)??s("order.priceUnknown")," €"]}),e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-semibold text-primary-color text-sm text-right",children:[(t==null?void 0:t.total_ttc)??s("order.totalUnknown")," €"]})]})]})}),e.jsxs("div",{className:"flex items-end justify-between relative self-stretch w-full flex-[0_0_auto]",children:[e.jsxs("div",{className:"relative w-fit font-body-extra-small-text-regular text-secondary-color",children:[s("order.saveLabel")," "]}),e.jsxs("div",{className:"font-small-medium text-secondary-color leading-small relative w-fit mt-[-1.00px] text-right",children:[(t==null?void 0:t.discount)??s("order.discountUnknown")," €"]})]})]})})},Z=({heading:x,btnText:p,stripePromise:f})=>{a.useState(!1);const i=L(),{t:s}=I(),o=new URLSearchParams(location.search);o.get("dealId");const r=o.get("orderId"),m=()=>{p===s("withdrawal.validate_payment_button")?i("/admin-view-deal"):i("/admin-wallet")};return a.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsx("div",{className:"flex flex-col w-full h-full items-start relative bg-primary-background mx-auto",children:e.jsxs("div",{className:"flex flex-col w-full items-start gap-[15px] px-[35px] py-[15px] relative flex-[0_0_auto]",children:[e.jsx("div",{className:"relative self-stretch mt-[-1.00px] [font-family:'Inter',Helvetica] font-semibold text-primary-color text-2xl tracking-[0] leading-[30px]",children:x}),e.jsx(Q,{orderId:r}),e.jsx(J,{stripePromise:f,heading:x,btnText:p,orderId:r}),e.jsx(S,{}),e.jsx("button",{className:"all-[unset] box-border flex items-center justify-center gap-2 px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md border border-solid border-primary-color cursor-pointer",onClick:m,children:e.jsxs("div",{className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-primary-color text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:[s("withdrawal.back_button")," "]})})]})})};export{Z as default};
