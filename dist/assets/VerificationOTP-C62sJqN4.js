import{a as M,r as o,R,l as I,u as L,c as O,j as e,S as B,B as S,C as q,e as j,f as A}from"./index-CBvyokpL.js";import{S as F}from"./ShowCustomSuccessModal-BqMvT-OE.js";import"./CheckmarkCircle3-fl_To1cl.js";const U=({value:a,onChange:i,index:t,inputRefs:c,otp:f,setOtp:d})=>e.jsx("div",{className:"flex flex-col w-12 h-12 items-start gap-[5px] relative",children:e.jsx("div",{className:"flex flex-col items-center gap-2.5 relative flex-1 self-stretch w-full grow",children:e.jsx("input",{type:"text",maxLength:"1",value:a,onChange:r=>i(r.target.value,t),ref:c.current[t],onKeyDown:r=>{r.key==="Backspace"&&!a&&t>0&&c.current[t-1].current.focus()},onPaste:r=>{const m=r.clipboardData.getData("Text"),p=[...f];m.slice(0,5).split("").forEach((x,g)=>{t+g<f.length&&(p[t+g]=x,c.current[t+g].current.value=x)}),d(p),c.current[Math.min(t+m.length,f.length-1)].current.focus(),r.preventDefault()},inputMode:"numeric",pattern:"[0-9]*",className:"flex items-start justify-center gap-2.5 pl-5 pr-4 py-3 relative flex-1 self-stretch w-full grow bg-white rounded-md border border-solid border-stroke text-[#1b4f4a] text-base tracking-[0] leading-6 text-center focus:outline-none"})})}),K=({initialSeconds:a,onResend:i,t})=>{const c=o.useRef(a),[f,d]=o.useState(c.current);return o.useEffect(()=>{const r=setInterval(()=>{c.current>0&&(c.current-=1,d(c.current))},1e3);return()=>clearInterval(r)},[]),e.jsx(e.Fragment,{children:f!==0?e.jsxs("div",{className:"relative w-fit font-normal text-secondary-text-color text-sm leading-[22px] whitespace-nowrap",children:[t("otp.send_again")," (",f,"s) "]}):e.jsx("div",{onClick:i,className:"w-full",children:e.jsx(S,{buttonText:t("otp.send_code_again"),className:"w-full hover:bg-secondary-background cursor-pointer",color:"primary",kind:"primary",round:"semi-round",state:"active"})})})},G=()=>{const{t:a}=M(),[i,t]=o.useState(Array(5).fill("")),[c,f]=o.useState(!0),[d,r]=o.useState(!1),m=o.useRef(i.map(()=>R.createRef())),p=I(),x=L(),h=new URLSearchParams(p.search).get("email"),N=O(),[_,w]=o.useState(!1),[k,y]=o.useState(""),[C,b]=o.useState(!1),[D,E]=o.useState(""),v=async()=>{var n,l;try{const s=await j.post("resend_code");(s==null?void 0:s.status)===200&&(b(!0),E(a("otp.code_sent")+" "+(h||"{email}")))}catch(s){console.error(a("Payment.error_title"),s),w(!0),y((l=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:l.detail)}};o.useEffect(()=>{v()},[]),o.useEffect(()=>{window.scrollTo(0,0)},[]);const T=(n,l)=>{if(/^[0-9]$/.test(n)||n===""){const s=[...i];s[l]=n,t(s),n!==""&&l<i.length-1&&m.current[l+1].current.focus(),s.every(u=>u!=="")?f(!1):f(!0)}},P=async()=>{var l,s;r(!0);const n=new FormData;n.append("email",h),n.append("verification_code",i.join(""));try{const u=await j.post("verify",n);(u==null?void 0:u.status)===201?(N(A()),x("/")):r(!1)}catch(u){console.error(a("Payment.error_title"),u),w(!0),y((s=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:s.detail),r(!1)}t(Array(5).fill("")),r(!1)};return e.jsxs("div",{className:"relative w-full h-[640px] bg-primary-background mx-auto",children:[_&&e.jsx(B,{message:k,buttonText:a("waiting_deal.got_it"),onClose:()=>w(!1)}),C&&e.jsx(F,{message:D,buttonText:a("waiting_deal.got_it"),onClose:()=>b(!1)}),!d&&e.jsxs("div",{className:"flex flex-col w-full items-start gap-[15px] px-[35px] py-[15px] absolute left-0",children:[e.jsxs("div",{className:"relative w-fit mt-[-1.00px] font-semibold text-[#1b4f4a] text-2xl text-center leading-[30px] whitespace-nowrap",children:[a("otp.confirm_email")," "]}),e.jsxs("p",{className:"relative w-fit font-normal text-[#1b4f4a] text-sm leading-[22px]",children:[a("otp.code_sent")," ",e.jsx("br",{}),h||"{email}"]}),e.jsx("div",{className:"flex items-center justify-between w-full",children:i.map((n,l)=>e.jsx(U,{value:n,onChange:T,index:l,inputRefs:m,otp:i,setOtp:t},l))}),e.jsx(K,{initialSeconds:180,onResend:v,t:a}),e.jsx("div",{onClick:c?null:P,className:"w-full",children:e.jsx(S,{buttonText:a("otp.login"),className:"w-full hover:bg-secondary-background cursor-pointer",color:"primary",kind:"primary",round:"semi-round",state:c?"disable":"active"})})]}),d&&e.jsx(q,{})]})};export{G as VerificationOTP,G as default};
