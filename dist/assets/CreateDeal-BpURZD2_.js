import{a as J,r as i,d as S,u as K,c as U,t as Y,v as Q,j as e,C as V,S as W,A as X,w as Z,T as ee,x as b,L as r,y as L,M as E,z as T,D as te,E as ae,G as le,I as ne,J as se,K as oe,N as ie,O as ce}from"./index-CnnvK9mg.js";import"./UserAlt-CKjyE0Hu.js";import"./LanguageDropdown-tSng40qW.js";import"./france-flag-icon-BP-lwE0P.js";const me=()=>{const{t}=J(),[H,v]=i.useState(!1),[F,P]=i.useState(""),A=S(n=>n.deals.dealForm),M=S(n=>n.deals.title),w=n=>{const a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),s=String(n.getHours()).padStart(2,"0"),g=String(n.getMinutes()).padStart(2,"0");return`${a}-${o}-${c}T${s}:${g}`},[l,d]=i.useState(A),[j,u]=i.useState(!1),[x,y]=i.useState([]),[m,N]=i.useState(!0),[f,C]=i.useState(M),D=K(),_=U(),h=new URLSearchParams(location.search).get("deal_id"),[de,$]=i.useState(new FormData),B=n=>{y([...x,n])},p=(n,a)=>{n==="acceptConditions"?d(o=>({...o,acceptConditions:!l.acceptConditions})):(console.log(t("create_deal.console_input_change"),a.target.value),d(o=>({...o,[n]:a.target.value})))},O=n=>{d(a=>({...a,pictures:n}))},R=(n,a)=>{d(o=>({...o,collectionLocation:a.target.value}))},q=n=>{d(a=>({...a,deliveryCost:n}))},I=(n,a)=>{d(o=>({...o,[n]:a}))},z=async n=>{n.preventDefault(),u(!0),console.log(t("create_deal.console_submit"),{formData:l,products:x,title:f});try{const a=new FormData;a.append("title",f),a.append("description",l.description),a.append("collection_location",l.collectionLocation),a.append("collection_date",l.collectionDate),a.append("content_description",l.contentDescription),a.append("artisan_information",l.manufacturerInfo),a.append("banking_info[iban]",l.iban),a.append("banking_info[bic]",l.bic),a.append("deal_expiration_date",l.dealExpiration),a.append("terms_accepted",l.acceptConditions),a.append("delivery_cost",l.deliveryCost),l.pictures&&l.pictures.length>0?l.pictures.forEach((s,g)=>{s instanceof File?(console.log(t("create_deal.console_append_file"),s.name),a.append("images",s)):console.error(t("create_deal.console_invalid_file"))}):console.error(t("create_deal.console_no_pictures")),x.forEach((s,g)=>{Object.keys(s).forEach(k=>{a.append(`products[${g}][${k}]`,s[k])})});const o=await _(ie(a)).unwrap(),c=o.deal_id;console.log(t("create_deal.console_success"),o),D(`/inform-deal?id=${c}`)}catch(a){console.error(t("create_deal.console_failure"),a),v(!0),P((a==null?void 0:a.detail)||t("create_deal.error_message"))}finally{u(!1)}};i.useEffect(()=>{window.scrollTo(0,0)},[]),i.useEffect(()=>{(async()=>{var a,o;if(h){u(!0),console.log(t("create_deal.console_fetching"),h);try{const c=await _(ce(h)).unwrap(),s=c==null?void 0:c.Deal[0];s&&(C(s.deal_title??t("create_deal.default_title")),d({description:s.description??t("create_deal.default_description"),collectionDate:s.collection_date??w(new Date),contentDescription:s.content_description??t("create_deal.default_content_description"),manufacturerInfo:s.artisan_information??t("create_deal.default_manufacturer_info"),iban:((a=s.banking_info)==null?void 0:a.iban)??t("create_deal.default_iban"),bic:((o=s.banking_info)==null?void 0:o.bic)??t("create_deal.default_bic"),dealExpiration:s.deal_expiration_date??w(new Date),acceptConditions:s.terms_accepted??!1,collectionLocation:s.collection_location??t("create_deal.default_collection_location"),pictures:s.images??[]}),y(s.products??[]))}catch(c){console.error(t("create_deal.console_fetching_error"),c)}u(!1)}})()},[h,t]);const G=()=>{D("/")};return i.useEffect(()=>{_(Y(f)),_(Q(l))},[l,f]),e.jsxs(e.Fragment,{children:[j&&e.jsx(V,{}),H&&e.jsx(W,{message:F,buttonText:t("waiting_deal.got_it"),onClose:()=>v(!1)}),!j&&e.jsx("form",{onSubmit:z,className:"flex flex-col w-full items-start relative bg-primary-background mx-auto",children:e.jsxs("div",{className:"flex flex-col w-full items-start gap-[15px] px-[35px] py-[15px] relative flex-[0_0_auto]",children:[e.jsx("div",{className:"flex items-center gap-3 pt-0 pb-5 px-0 relative self-stretch w-full flex-[0_0_auto] border-b [border-bottom-style:solid] border-stroke",onClick:G,children:e.jsxs("div",{className:"inline-flex items-center gap-2 relative flex-[0_0_auto]",children:[e.jsx(X,{className:"!relative !w-[18px] !h-[18px]",color:"#637381"}),e.jsx("div",{className:"relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-primary-text-color text-base tracking-[0] leading-6 whitespace-nowrap",children:t("common.back")})]})}),e.jsx("div",{className:"relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-semibold text-[#1b4f4a] text-2xl text-center tracking-[0] leading-[30px] whitespace-nowrap",children:t("create_deal.title")}),e.jsx(Z,{onChange:O,setForm:$}),e.jsx(ee,{dealTitle:f,setDealTitle:C}),e.jsx("div",{className:"w-full",children:e.jsx(b,{name:"description",type:"description",description:l.description,onChange:p,className:"!self-stretch !w-full",divClassName:"!text-[#1b4f4a] !text-lg !leading-[26px]",divClassNameOverride:"!tracking-[0] !text-base !flex-1 ![white-space:unset] ![font-style:unset] !font-normal ![font-family:'Inter',Helvetica] !leading-6 !w-[unset]",groupClassName:"!w-[42px]",helperText:"off",label:t("create_deal.description_label"),label1:"on",placeholder:t("create_deal.description_placeholder"),secondLabel:"on",secondLabelText:"0/250",state:"default"})}),e.jsx(r,{}),e.jsx("div",{className:"!w-full",children:e.jsx(L,{type:"collectionLocation",onChange:R,value:l.collectionLocation})}),e.jsx("div",{className:"relative w-fit [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-base tracking-[0] leading-6 whitespace-nowrap",children:t("create_deal.collection_date_label")}),e.jsx("div",{className:"w-full",children:e.jsx(E,{name:"collectionDate",date:l.collectionDate,onChange:I})}),e.jsx(r,{}),e.jsx("div",{className:"!w-full",children:e.jsx(L,{type:"deliveryCost",onChange:q,value:l.deliveryCost})}),e.jsx(r,{}),e.jsx("div",{className:"w-full",children:e.jsx(b,{name:"contentDescription",type:"contentDescription",value:l.contentDescription,onChange:p,className:"!self-stretch !w-full",divClassName:"!text-[#1b4f4a] !text-lg !leading-[26px]",divClassNameOverride:"!tracking-[0] !text-base !flex-1 ![white-space:unset] ![font-style:unset] !font-normal ![font-family:'Inter',Helvetica] !leading-6 !w-[unset]",groupClassName:"!w-[42px]",helperText:"off",label:t("create_deal.content_description_label"),label1:"on",placeholder:t("create_deal.content_description_placeholder"),secondLabel:"on",secondLabelText:"0/250",state:"default"})}),e.jsx(r,{}),e.jsx("div",{className:"w-full",children:e.jsx(b,{name:"manufacturerInfo",type:"manufacturerInfo",value:l.manufacturerInfo,onChange:p,className:"!self-stretch !w-full",divClassName:"!text-[#1b4f4a] !text-lg ![white-space:unset] !leading-[26px] !w-[236px]",divClassNameOverride:"!tracking-[0] !text-base !flex-1 ![white-space:unset] ![font-style:unset] !font-normal ![font-family:'Inter',Helvetica] !leading-6 !w-[unset]",groupClassName:"!w-[42px]",helperText:"off",label:t("create_deal.artisan_info_label"),label1:"on",placeholder:t("create_deal.artisan_info_placeholder"),secondLabel:"on",secondLabelText:"0/250",state:"default"})}),e.jsx(r,{}),e.jsx("p",{className:"relative w-full [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-lg tracking-[0] leading-[26px]",children:t("create_deal.banking_info_label")}),e.jsx("div",{className:"w-full h-6",children:e.jsx("div",{className:"[font-family:'Inter-Regular',Helvetica] font-normal text-primary-color text-base tracking-[0] leading-6 whitespace-nowrap",children:"IBAN"})}),e.jsx("div",{className:"w-full",children:e.jsx(T,{name:"iban",type:"iban",value:l.iban,onChange:p,label:t("create_deal.iban_label"),placeholder:t("create_deal.iban_placeholder")})}),e.jsx("div",{className:"w-full h-6",children:e.jsx("div",{className:"[font-family:'Inter-Regular',Helvetica] font-normal text-primary-color text-base tracking-[0] leading-6 whitespace-nowrap",children:"BIC"})}),e.jsx("div",{className:"w-full",children:e.jsx(T,{name:"bic",type:"bic",value:l.bic,onChange:p,label:t("create_deal.bic_label"),placeholder:t("create_deal.bic_placeholder")})}),e.jsx(r,{}),e.jsx(te,{}),e.jsx("div",{className:"w-full",children:e.jsx(E,{name:"dealExpiration",value:l.dealExpiration,onChange:I})}),e.jsx(r,{}),e.jsx(ae,{products:x}),e.jsx(r,{}),e.jsx("div",{className:"flex w-[250px] items-start gap-2.5 relative flex-[0_0_auto]",children:e.jsx("div",{className:"relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-lg tracking-[0] leading-[26px] whitespace-nowrap",children:t("create_deal.add_products_label")})}),m===!0&&e.jsx(le,{addProduct:B,setAddMode:N,addMode:m}),!m&&e.jsxs("div",{className:"gap-2 bg-white shadow-shadow-1 flex items-center justify-center px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md cursor-pointer",onClick:()=>N(!m),children:[e.jsx(ne,{className:"!relative !w-5 !h-5"}),e.jsx("button",{type:"button",className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:t("create_deal.add_another_product_label")})]}),e.jsx(r,{}),e.jsx(se,{formData:l,handleChange:p}),e.jsxs("button",{type:"submit",className:"gap-2.5 bg-[#1b4f4a] flex items-center justify-center px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md cursor-pointer",children:[e.jsx("div",{className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-white text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:t("create_deal.next_step_button")}),e.jsx(oe,{className:"!relative !w-5 !h-5",color:"white"})]})]})})]})};export{me as default};
