import{J as D,K as F,r,d as O,a as j,u as P,c as R,k as U,j as e,N as A,O as H,C as M,L as E,w as q,Q as B,T as W,e as z}from"./index-CS3NMoRv.js";import{S as J}from"./ErrorAlert-C-hqL7u8.js";import{O as K}from"./OrderInfo-Bm4io8gp.js";import"./InfoCircle8-ZKYNMSt7.js";function Q({heading:h,btnText:y,stripeCustomerId:g}){var k;const o=D(),s=F(),[i,t]=r.useState(null),[d,b]=r.useState(!1),m=O(f=>f.account.profile),[w,v]=r.useState((k=m==null?void 0:m.data)==null?void 0:k.email),{t:c}=j(),l=P(),S=R(),_=U(),[p,u]=r.useState(!1),a=new URLSearchParams(_.search).get("orderId"),L=async f=>{if(f.preventDefault(),!o||!s){t(c("checkout.stripe_not_loaded"));return}b(!0),t("");try{const{setupIntent:I,error:x}=await o.confirmSetup({elements:s,confirmParams:{},redirect:"if_required"});if(x)x.type==="card_error"||x.type==="validation_error"?t(x.message):t(c("checkout.unexpected_error")),console.error("Error during setup confirmation:",x);else{console.log("SetupIntent confirmed:",I),u(!0);try{await S(B({orderId:a,setupIntent:I,stripeCustomerId:g})),t(c("checkout.setup_confirmed")),l(`/thanks-payment-setup?orderId=${a}`)}catch(T){console.error("Error during dispatch:",T),t(c("checkout.processing_error"))}finally{u(!1)}}}catch(I){console.error("Unexpected error in setup confirmation:",I),t(c("checkout.unexpected_error_setup"))}finally{b(!1)}},N={layout:{type:"accordion",defaultCollapsed:!1,radios:!1,spacedAccordionItems:!0},appearance:{theme:"flat",variables:{colorPrimaryText:"#262626",colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Ideal Sans, system-ui, sans-serif",spacingUnit:"2px",borderRadius:"4px"},rules:{".Label":{display:"none"},".Input":{minHeight:"48px"}}}},C={defaultValues:{email:w},appearance:{theme:"flat",variables:{colorPrimaryText:"#262626",colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Ideal Sans, system-ui, sans-serif"},rules:{".Label":{display:"none"},".Input":{height:"76px"},".p-LinkInputWrapper":{height:"96px !important",display:"flex","align-items":"center"},".p-LinkInputWrapper input":{height:"78px !important",padding:"12px !important",border:"1px solid #ccc !important","border-radius":"4px !important","font-size":"36px !important",width:"100% !important"}}}};return e.jsxs("form",{id:"payment-form",onSubmit:L,className:"mx-auto w-full max-w-lg space-y-4",children:[!p&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{id:"link-authentication-element",onChange:f=>{v(f.value.email)},options:C}),e.jsx(H,{id:"payment-element",options:N,className:"pt-3"})]}),p&&e.jsx(M,{}),i&&e.jsx("div",{id:"payment-message",className:"mt-3 p-3 text-red-600 bg-red-100 border border-red-400 rounded",children:i}),e.jsx(E,{}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2.5 px-6 py-3 relative self-stretch w-full flex-[0_0_auto] bg-primary-color rounded-md",children:[e.jsxs("button",{type:"submit",disabled:d||!o||!s,className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-white text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:[c("checkout.submit_button")," "]}),e.jsx(q,{className:"!relative !w-5 !h-5",color:"white"})]})]})}function V({orderId:h,heading:y,btnText:g,...o}){const{stripePromise:s}=o,[i,t]=r.useState(""),[d,b]=r.useState(""),[m,w]=r.useState(!1),[v,c]=r.useState(""),{t:l}=j();return r.useEffect(()=>{(async()=>{var _,p,u;try{const n=new FormData;n.append("amount",10),n.append("currency","eur");const a=await z.post("/create_payment_intent",n);console.log((_=a==null?void 0:a.data)==null?void 0:_.payment_intent[0]),t((p=a==null?void 0:a.data)==null?void 0:p.payment_intent[0]),b((u=a==null?void 0:a.data)==null?void 0:u.payment_intent[1])}catch(n){console.error("Error creating PaymentIntent:",n),w(!0),c((n==null?void 0:n.detail)||l("Payment.fetch_error_message"))}})()},[l]),e.jsxs(e.Fragment,{children:[m&&e.jsx(J,{message:v,buttonText:l("waiting_deal.got_it"),onClose:()=>w(!1)}),i&&s&&e.jsx(W,{stripe:s,options:{clientSecret:i},children:e.jsx(Q,{heading:l("Payment.heading"),btnText:l("Payment.button_text"),stripeCustomerId:d})})]})}const Z=({heading:h,btnText:y,stripePromise:g})=>{r.useState(!1);const o=P(),{t:s}=j(),i=new URLSearchParams(location.search);i.get("dealId");const t=i.get("orderId"),d=()=>{y===s("withdrawal.validate_payment_button")?o("/admin-view-deal"):o("/admin-wallet")};return r.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsx("div",{className:"flex flex-col w-full h-full items-start relative bg-primary-background mx-auto",children:e.jsxs("div",{className:"flex flex-col w-full items-start gap-[15px] px-[35px] py-[15px] relative flex-[0_0_auto]",children:[e.jsx("div",{className:"relative self-stretch mt-[-1.00px] [font-family:'Inter',Helvetica] font-semibold text-primary-color text-2xl tracking-[0] leading-[30px]",children:h}),e.jsx(K,{orderId:t}),e.jsx(V,{stripePromise:g,heading:h,btnText:y,orderId:t}),e.jsx(E,{}),e.jsx("button",{className:"all-[unset] box-border flex items-center justify-center gap-2 px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md border border-solid border-primary-color cursor-pointer",onClick:d,children:e.jsxs("div",{className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-primary-color text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:[s("withdrawal.back_button")," "]})})]})})};export{Z as default};
