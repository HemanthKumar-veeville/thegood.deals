import{y as F,z as A,r as n,g as D,a as S,u as P,c as O,f as R,j as e,D as T,E as U,C as H,L as _,m as q,G as B,J as W,d as z}from"./index--xWzEY9_.js";import{O as V}from"./OrderInfo-Cp-EBuk6.js";import"./InfoCircle8-BwF2P4E4.js";function G({heading:u,btnText:l,stripeCustomerId:c}){var j;const o=F(),s=A(),[i,t]=n.useState(null),[d,f]=n.useState(!1),x=D(m=>m.account.profile),[y,h]=n.useState((j=x==null?void 0:x.data)==null?void 0:j.email),{t:g}=S(),r=P(),a=O(),k=R(),[b,v]=n.useState(!1),I=new URLSearchParams(k.search).get("orderId"),E=async m=>{if(m.preventDefault(),!o||!s){t("Stripe has not fully loaded yet. Please try again.");return}f(!0),t("");try{const{setupIntent:w,error:p}=await o.confirmSetup({elements:s,confirmParams:{},redirect:"if_required"});if(p)p.type==="card_error"||p.type==="validation_error"?t(p.message):t("An unexpected error occurred. Please try again."),console.error("Error during setup confirmation:",p);else{console.log("SetupIntent confirmed:",w),v(!0);try{await a(B({orderId:I,setupIntent:w,stripeCustomerId:c})),t("Setup confirmed successfully."),r(`/thanks-payment-setup?orderId=${I}`)}catch(C){console.error("Error during dispatch:",C),t("An error occurred while processing the payment setup.")}finally{v(!1)}}}catch(w){console.error("Unexpected error in setup confirmation:",w),t("An unexpected error occurred during setup confirmation.")}finally{f(!1)}},L={layout:{type:"accordion",defaultCollapsed:!1,radios:!1,spacedAccordionItems:!0},appearance:{theme:"flat",variables:{colorPrimaryText:"#262626",colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Ideal Sans, system-ui, sans-serif",spacingUnit:"2px",borderRadius:"4px"},rules:{".Label":{display:"none"},".Input":{minHeight:"48px"}}}},N={defaultValues:{email:y},appearance:{theme:"flat",variables:{colorPrimaryText:"#262626",colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Ideal Sans, system-ui, sans-serif"},rules:{".Label":{display:"none"},".Input":{height:"76px"},".p-LinkInputWrapper":{height:"96px !important",display:"flex","align-items":"center"},".p-LinkInputWrapper input":{height:"78px !important",padding:"12px !important",border:"1px solid #ccc !important","border-radius":"4px !important","font-size":"36px !important",width:"100% !important"}}}};return e.jsxs("form",{id:"payment-form",onSubmit:E,className:"mx-auto w-full max-w-lg space-y-4",children:[!b&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(T,{id:"link-authentication-element",onChange:m=>{h(m.value.email)},options:N}),e.jsx(U,{id:"payment-element",options:L,className:"pt-3"})]}),b&&e.jsx(H,{}),i&&e.jsx("div",{id:"payment-message",className:"mt-3 p-3 text-red-600 bg-red-100 border border-red-400 rounded",children:i}),e.jsx("img",{className:"relative self-stretch w-full h-px object-cover mt-3",alt:g("withdrawal.line_alt"),src:_}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2.5 px-6 py-3 relative self-stretch w-full flex-[0_0_auto] bg-primary-color rounded-md",children:[e.jsx("button",{type:"submit",disabled:d||!o||!s,className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-white text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:l}),e.jsx(q,{className:"!relative !w-5 !h-5",color:"white"})]})]})}function J({orderId:u,heading:l,btnText:c,...o}){const{stripePromise:s}=o,[i,t]=n.useState(""),[d,f]=n.useState("");return n.useEffect(()=>{(async()=>{var y,h,g;try{const r=new FormData;r.append("amount",10),r.append("currency","eur");const a=await z.post("/create_payment_intent",r);console.log((y=a==null?void 0:a.data)==null?void 0:y.payment_intent[0]),t((h=a==null?void 0:a.data)==null?void 0:h.payment_intent[0]),f((g=a==null?void 0:a.data)==null?void 0:g.payment_intent[1])}catch(r){console.error("Error creating PaymentIntent:",r),await Swal.fire({icon:"error",title:"Error...",text:(r==null?void 0:r.detail)||"Failed to Fetch intent. Please try again."})}})()},[]),e.jsx(e.Fragment,{children:i&&s&&e.jsx(W,{stripe:s,options:{clientSecret:i},children:e.jsx(G,{heading:l,btnText:c,stripeCustomerId:d})})})}const X=({heading:u,btnText:l,stripePromise:c})=>{n.useState(!1);const o=P(),{t:s}=S(),i=new URLSearchParams(location.search);i.get("dealId");const t=i.get("orderId"),d=()=>{o(l==="Validate payment"?"/admin-view-deal":"/admin-wallet")};return n.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsx("div",{className:"flex flex-col w-full h-full items-start relative bg-primary-background mx-auto",children:e.jsxs("div",{className:"flex flex-col w-full items-start gap-[15px] px-[35px] py-[15px] relative flex-[0_0_auto]",children:[e.jsx("div",{className:"relative self-stretch mt-[-1.00px] [font-family:'Inter',Helvetica] font-semibold text-primary-color text-2xl tracking-[0] leading-[30px]",children:u}),e.jsx(V,{orderId:t}),e.jsx(J,{stripePromise:c,heading:u,btnText:l,orderId:t}),e.jsx("img",{className:"relative self-stretch w-full h-px object-cover",alt:s("withdrawal.line_alt"),src:_}),e.jsx("button",{className:"all-[unset] box-border flex items-center justify-center gap-2 px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md border border-solid border-primary-color cursor-pointer",onClick:d,children:e.jsx("div",{className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-primary-color text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:s("withdrawal.back_button")})})]})})};export{X as default};
