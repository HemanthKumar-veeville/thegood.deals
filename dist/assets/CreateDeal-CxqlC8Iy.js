import{a as z,r as i,d as S,u as G,c as J,t as K,v as U,j as e,C as Y,S as Q,A as V,w as W,T as X,x as b,L as r,y as Z,M as L,z as E,D as ee,E as ae,G as te,I as le,J as ne,K as se,N as oe,O as ie}from"./index-DUk8N2GI.js";const pe=()=>{const{t:a}=z(),[T,w]=i.useState(!1),[H,F]=i.useState(""),P=S(n=>n.deals.dealForm),A=S(n=>n.deals.title),v=n=>{const t=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),s=String(n.getHours()).padStart(2,"0"),g=String(n.getMinutes()).padStart(2,"0");return`${t}-${o}-${c}T${s}:${g}`},[l,d]=i.useState(P),[j,u]=i.useState(!1),[x,y]=i.useState([]),[m,N]=i.useState(!0),[f,C]=i.useState(A),D=G(),_=J(),h=new URLSearchParams(location.search).get("deal_id"),[re,M]=i.useState(new FormData),$=n=>{y([...x,n])},p=(n,t)=>{n==="acceptConditions"?d(o=>({...o,acceptConditions:!l.acceptConditions})):(console.log(a("create_deal.console_input_change"),t.target.value),d(o=>({...o,[n]:t.target.value})))},B=n=>{d(t=>({...t,pictures:n}))},O=(n,t)=>{d(o=>({...o,collectionLocation:t.target.value}))},I=(n,t)=>{d(o=>({...o,[n]:t}))},R=async n=>{n.preventDefault(),u(!0),console.log(a("create_deal.console_submit"),{formData:l,products:x,title:f});try{const t=new FormData;t.append("title",f),t.append("description",l.description),t.append("collection_location",l.collectionLocation),t.append("collection_date",l.collectionDate),t.append("content_description",l.contentDescription),t.append("artisan_information",l.manufacturerInfo),t.append("banking_info[iban]",l.iban),t.append("banking_info[bic]",l.bic),t.append("deal_expiration_date",l.dealExpiration),t.append("terms_accepted",l.acceptConditions),t.append("delivery_cost",l.deliveryCost),l.pictures&&l.pictures.length>0?l.pictures.forEach((s,g)=>{s instanceof File?(console.log(a("create_deal.console_append_file"),s.name),t.append("images",s)):console.error(a("create_deal.console_invalid_file"))}):console.error(a("create_deal.console_no_pictures")),x.forEach((s,g)=>{Object.keys(s).forEach(k=>{t.append(`products[${g}][${k}]`,s[k])})});const o=await _(oe(t)).unwrap(),c=o.deal_id;console.log(a("create_deal.console_success"),o),D(`/inform-deal?id=${c}`)}catch(t){console.error(a("create_deal.console_failure"),t),w(!0),F((t==null?void 0:t.detail)||a("create_deal.error_message"))}finally{u(!1)}};i.useEffect(()=>{window.scrollTo(0,0)},[]),i.useEffect(()=>{(async()=>{var t,o;if(h){u(!0),console.log(a("create_deal.console_fetching"),h);try{const c=await _(ie(h)).unwrap(),s=c==null?void 0:c.Deal[0];s&&(C(s.deal_title??a("create_deal.default_title")),d({description:s.description??a("create_deal.default_description"),collectionDate:s.collection_date??v(new Date),contentDescription:s.content_description??a("create_deal.default_content_description"),manufacturerInfo:s.artisan_information??a("create_deal.default_manufacturer_info"),iban:((t=s.banking_info)==null?void 0:t.iban)??a("create_deal.default_iban"),bic:((o=s.banking_info)==null?void 0:o.bic)??a("create_deal.default_bic"),dealExpiration:s.deal_expiration_date??v(new Date),acceptConditions:s.terms_accepted??!1,collectionLocation:s.collection_location??a("create_deal.default_collection_location"),pictures:s.images??[]}),y(s.products??[]))}catch(c){console.error(a("create_deal.console_fetching_error"),c)}u(!1)}})()},[h,a]);const q=()=>{D("/")};return i.useEffect(()=>{_(K(f)),_(U(l))},[l,f]),e.jsxs(e.Fragment,{children:[j&&e.jsx(Y,{}),T&&e.jsx(Q,{message:H,buttonText:a("waiting_deal.got_it"),onClose:()=>w(!1)}),!j&&e.jsx("form",{onSubmit:R,className:"flex flex-col w-full items-start relative bg-primary-background mx-auto",children:e.jsxs("div",{className:"flex flex-col w-full items-start gap-[15px] px-[35px] py-[15px] relative flex-[0_0_auto]",children:[e.jsx("div",{className:"flex items-center gap-3 pt-0 pb-5 px-0 relative self-stretch w-full flex-[0_0_auto] border-b [border-bottom-style:solid] border-stroke",onClick:q,children:e.jsxs("div",{className:"inline-flex items-center gap-2 relative flex-[0_0_auto]",children:[e.jsx(V,{className:"!relative !w-[18px] !h-[18px]",color:"#637381"}),e.jsx("div",{className:"relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-primary-text-color text-base tracking-[0] leading-6 whitespace-nowrap",children:a("common.back")})]})}),e.jsx("div",{className:"relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-semibold text-[#1b4f4a] text-2xl text-center tracking-[0] leading-[30px] whitespace-nowrap",children:a("create_deal.title")}),e.jsx(W,{onChange:B,setForm:M}),e.jsx(X,{dealTitle:f,setDealTitle:C}),e.jsx("div",{className:"w-full",children:e.jsx(b,{name:"description",type:"description",description:l.description,onChange:p,className:"!self-stretch !w-full",divClassName:"!text-[#1b4f4a] !text-lg !leading-[26px]",divClassNameOverride:"!tracking-[0] !text-base !flex-1 ![white-space:unset] ![font-style:unset] !font-normal ![font-family:'Inter',Helvetica] !leading-6 !w-[unset]",groupClassName:"!w-[42px]",helperText:"off",label:a("create_deal.description_label"),label1:"on",placeholder:a("create_deal.description_placeholder"),secondLabel:"on",secondLabelText:"0/250",state:"default"})}),e.jsx(r,{}),e.jsx("div",{className:"!w-full",children:e.jsx(Z,{type:"collectionLocation",onChange:O,value:l.collectionLocation})}),e.jsx("div",{className:"relative w-fit [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-base tracking-[0] leading-6 whitespace-nowrap",children:a("create_deal.collection_date_label")}),e.jsx("div",{className:"w-full",children:e.jsx(L,{name:"collectionDate",date:l.collectionDate,onChange:I})}),e.jsx(r,{}),e.jsx("div",{className:"w-full",children:e.jsx(b,{name:"contentDescription",type:"contentDescription",value:l.contentDescription,onChange:p,className:"!self-stretch !w-full",divClassName:"!text-[#1b4f4a] !text-lg !leading-[26px]",divClassNameOverride:"!tracking-[0] !text-base !flex-1 ![white-space:unset] ![font-style:unset] !font-normal ![font-family:'Inter',Helvetica] !leading-6 !w-[unset]",groupClassName:"!w-[42px]",helperText:"off",label:a("create_deal.content_description_label"),label1:"on",placeholder:a("create_deal.content_description_placeholder"),secondLabel:"on",secondLabelText:"0/250",state:"default"})}),e.jsx(r,{}),e.jsx("div",{className:"w-full",children:e.jsx(b,{name:"manufacturerInfo",type:"manufacturerInfo",value:l.manufacturerInfo,onChange:p,className:"!self-stretch !w-full",divClassName:"!text-[#1b4f4a] !text-lg ![white-space:unset] !leading-[26px] !w-[236px]",divClassNameOverride:"!tracking-[0] !text-base !flex-1 ![white-space:unset] ![font-style:unset] !font-normal ![font-family:'Inter',Helvetica] !leading-6 !w-[unset]",groupClassName:"!w-[42px]",helperText:"off",label:a("create_deal.artisan_info_label"),label1:"on",placeholder:a("create_deal.artisan_info_placeholder"),secondLabel:"on",secondLabelText:"0/250",state:"default"})}),e.jsx(r,{}),e.jsx("p",{className:"relative w-full [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-lg tracking-[0] leading-[26px]",children:a("create_deal.banking_info_label")}),e.jsx("div",{className:"w-full h-6",children:e.jsx("div",{className:"[font-family:'Inter-Regular',Helvetica] font-normal text-primary-color text-base tracking-[0] leading-6 whitespace-nowrap",children:"IBAN"})}),e.jsx("div",{className:"w-full",children:e.jsx(E,{name:"iban",type:"iban",value:l.iban,onChange:p,label:a("create_deal.iban_label"),placeholder:a("create_deal.iban_placeholder")})}),e.jsx("div",{className:"w-full h-6",children:e.jsx("div",{className:"[font-family:'Inter-Regular',Helvetica] font-normal text-primary-color text-base tracking-[0] leading-6 whitespace-nowrap",children:"BIC"})}),e.jsx("div",{className:"w-full",children:e.jsx(E,{name:"bic",type:"bic",value:l.bic,onChange:p,label:a("create_deal.bic_label"),placeholder:a("create_deal.bic_placeholder")})}),e.jsx(r,{}),e.jsx(ee,{}),e.jsx("div",{className:"w-full",children:e.jsx(L,{name:"dealExpiration",value:l.dealExpiration,onChange:I})}),e.jsx(r,{}),e.jsx(ae,{products:x}),e.jsx(r,{}),e.jsx("div",{className:"flex w-[250px] items-start gap-2.5 relative flex-[0_0_auto]",children:e.jsx("div",{className:"relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-lg tracking-[0] leading-[26px] whitespace-nowrap",children:a("create_deal.add_products_label")})}),m===!0&&e.jsx(te,{addProduct:$,setAddMode:N,addMode:m}),!m&&e.jsxs("div",{className:"gap-2 bg-white shadow-shadow-1 flex items-center justify-center px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md cursor-pointer",onClick:()=>N(!m),children:[e.jsx(le,{className:"!relative !w-5 !h-5"}),e.jsx("button",{type:"button",className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-[#1b4f4a] text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:a("create_deal.add_another_product_label")})]}),e.jsx(r,{}),e.jsx(ne,{formData:l,handleChange:p}),e.jsxs("button",{type:"submit",className:"gap-2.5 bg-[#1b4f4a] flex items-center justify-center px-6 py-3 relative self-stretch w-full flex-[0_0_auto] rounded-md cursor-pointer",children:[e.jsx("div",{className:"all-[unset] box-border relative w-fit mt-[-1.00px] [font-family:'Inter',Helvetica] font-medium text-white text-base text-center tracking-[0] leading-6 whitespace-nowrap",children:a("create_deal.next_step_button")}),e.jsx(se,{className:"!relative !w-5 !h-5",color:"white"})]})]})})]})};export{pe as default};
